<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Blueprint ‚Äî PAWS Alert Infrastructure</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #050810;
  --blue: #3B82F6;
  --purple: #8B5CF6;
  --green: #10B981;
  --gold: #F59E0B;
  --red: #EF4444;
  --cyan: #06B6D4;
  --pink: #EC4899;
  --mono: 'IBM Plex Mono', monospace;
  --sans: 'Syne', sans-serif;
}

html, body {
  width: 100%; min-height: 100vh;
  background: var(--bg);
  color: white;
  font-family: var(--sans);
  overflow-x: hidden;
}

/* Animated grid background */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(59,130,246,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(59,130,246,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none; z-index: 0;
}

.page {
  position: relative; z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 48px 32px 80px;
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 64px;
}
.header-eyebrow {
  font-family: var(--mono);
  font-size: 11px; font-weight: 700;
  letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--blue); margin-bottom: 12px;
  display: flex; align-items: center; justify-content: center; gap: 10px;
}
.header-eyebrow::before, .header-eyebrow::after {
  content: ''; width: 40px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--blue));
}
.header-eyebrow::after { background: linear-gradient(90deg, var(--blue), transparent); }
.header h1 {
  font-size: clamp(28px, 4vw, 48px);
  font-weight: 800; letter-spacing: -0.03em;
  margin-bottom: 10px;
}
.header h1 span { color: var(--gold); }
.header-sub {
  font-family: var(--mono); font-size: 12px;
  color: rgba(255,255,255,0.35); letter-spacing: 0.05em;
}

/* Diagram container */
.diagram {
  position: relative;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: auto auto auto;
  gap: 0;
  padding: 20px 0;
}

/* SVG connector layer */
.connectors {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  pointer-events: none; z-index: 0;
  overflow: visible;
}

/* Node cards */
.node {
  position: relative; z-index: 2;
  margin: 12px;
  border-radius: 16px;
  padding: 20px;
  cursor: default;
  transition: transform 0.2s, box-shadow 0.2s;
  animation: fadeUp 0.6s ease both;
}
.node:hover { transform: translateY(-3px); }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

.node-icon {
  font-size: 28px; margin-bottom: 10px; display: block;
}
.node-label {
  font-family: var(--mono); font-size: 9px; font-weight: 700;
  letter-spacing: 0.15em; text-transform: uppercase;
  margin-bottom: 6px;
}
.node-name {
  font-size: 16px; font-weight: 800; letter-spacing: -0.02em;
  margin-bottom: 4px; line-height: 1.2;
}
.node-detail {
  font-family: var(--mono); font-size: 10px;
  color: rgba(255,255,255,0.45); line-height: 1.5;
}
.node-badge {
  display: inline-flex; align-items: center; gap: 4px;
  font-family: var(--mono); font-size: 9px; font-weight: 700;
  padding: 3px 8px; border-radius: 4px; margin-top: 8px;
  letter-spacing: 0.05em;
}
.node-url {
  font-family: var(--mono); font-size: 9px;
  margin-top: 8px; opacity: 0.5;
  word-break: break-all;
}

/* Color themes per node */
.node-blue {
  background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.06));
  border: 1px solid rgba(59,130,246,0.3);
  box-shadow: 0 0 30px rgba(59,130,246,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-blue:hover { box-shadow: 0 8px 40px rgba(59,130,246,0.2); }
.node-blue .node-label { color: var(--blue); }
.node-blue .node-badge { background: rgba(59,130,246,0.2); color: #93C5FD; border: 1px solid rgba(59,130,246,0.3); }

.node-purple {
  background: linear-gradient(135deg, rgba(139,92,246,0.12), rgba(139,92,246,0.06));
  border: 1px solid rgba(139,92,246,0.3);
  box-shadow: 0 0 30px rgba(139,92,246,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-purple:hover { box-shadow: 0 8px 40px rgba(139,92,246,0.2); }
.node-purple .node-label { color: #A78BFA; }
.node-purple .node-badge { background: rgba(139,92,246,0.2); color: #C4B5FD; border: 1px solid rgba(139,92,246,0.3); }

.node-green {
  background: linear-gradient(135deg, rgba(16,185,129,0.12), rgba(16,185,129,0.06));
  border: 1px solid rgba(16,185,129,0.3);
  box-shadow: 0 0 30px rgba(16,185,129,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-green:hover { box-shadow: 0 8px 40px rgba(16,185,129,0.2); }
.node-green .node-label { color: var(--green); }
.node-green .node-badge { background: rgba(16,185,129,0.2); color: #6EE7B7; border: 1px solid rgba(16,185,129,0.3); }

.node-gold {
  background: linear-gradient(135deg, rgba(245,158,11,0.12), rgba(245,158,11,0.06));
  border: 1px solid rgba(245,158,11,0.3);
  box-shadow: 0 0 30px rgba(245,158,11,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-gold:hover { box-shadow: 0 8px 40px rgba(245,158,11,0.2); }
.node-gold .node-label { color: var(--gold); }
.node-gold .node-badge { background: rgba(245,158,11,0.2); color: #FCD34D; border: 1px solid rgba(245,158,11,0.3); }

.node-red {
  background: linear-gradient(135deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06));
  border: 1px solid rgba(239,68,68,0.3);
  box-shadow: 0 0 30px rgba(239,68,68,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-red:hover { box-shadow: 0 8px 40px rgba(239,68,68,0.2); }
.node-red .node-label { color: #F87171; }
.node-red .node-badge { background: rgba(239,68,68,0.2); color: #FCA5A5; border: 1px solid rgba(239,68,68,0.3); }

.node-cyan {
  background: linear-gradient(135deg, rgba(6,182,212,0.12), rgba(6,182,212,0.06));
  border: 1px solid rgba(6,182,212,0.3);
  box-shadow: 0 0 30px rgba(6,182,212,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-cyan:hover { box-shadow: 0 8px 40px rgba(6,182,212,0.2); }
.node-cyan .node-label { color: var(--cyan); }
.node-cyan .node-badge { background: rgba(6,182,212,0.2); color: #67E8F9; border: 1px solid rgba(6,182,212,0.3); }

.node-pink {
  background: linear-gradient(135deg, rgba(236,72,153,0.12), rgba(236,72,153,0.06));
  border: 1px solid rgba(236,72,153,0.3);
  box-shadow: 0 0 30px rgba(236,72,153,0.08), inset 0 1px 0 rgba(255,255,255,0.05);
}
.node-pink:hover { box-shadow: 0 8px 40px rgba(236,72,153,0.2); }
.node-pink .node-label { color: var(--pink); }
.node-pink .node-badge { background: rgba(236,72,153,0.2); color: #F9A8D4; border: 1px solid rgba(236,72,153,0.3); }

/* Center hero node */
.node-center {
  grid-column: 2;
  grid-row: 2;
  background: linear-gradient(135deg, rgba(37,99,235,0.2), rgba(124,58,237,0.15));
  border: 1px solid rgba(99,102,241,0.5);
  box-shadow: 0 0 60px rgba(99,102,241,0.2), 0 0 120px rgba(99,102,241,0.08), inset 0 1px 0 rgba(255,255,255,0.1);
  text-align: center;
  padding: 28px 20px;
}
.node-center .node-name { font-size: 22px; }
.node-center .node-label { color: #A5B4FC; justify-content: center; display: flex; }
.node-center-pulse {
  width: 8px; height: 8px; border-radius: 50%;
  background: #6EE7B7;
  box-shadow: 0 0 12px #6EE7B7;
  margin: 10px auto 0;
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:0.6;transform:scale(1.3);} }

/* Grid layout positioning */
.pos-tl { grid-column: 1; grid-row: 1; animation-delay: 0.1s; }
.pos-tc { grid-column: 2; grid-row: 1; animation-delay: 0.2s; }
.pos-tr { grid-column: 3; grid-row: 1; animation-delay: 0.3s; }
.pos-ml { grid-column: 1; grid-row: 2; animation-delay: 0.4s; }
.pos-mc { grid-column: 2; grid-row: 2; animation-delay: 0.0s; }
.pos-mr { grid-column: 3; grid-row: 2; animation-delay: 0.4s; }
.pos-bl { grid-column: 1; grid-row: 3; animation-delay: 0.5s; }
.pos-bc { grid-column: 2; grid-row: 3; animation-delay: 0.6s; }
.pos-br { grid-column: 3; grid-row: 3; animation-delay: 0.5s; }

/* Flow arrows between nodes */
.flow-lines {
  position: relative;
  z-index: 1;
  margin: 0 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Legend */
.legend {
  margin-top: 48px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}
.legend-item {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 12px;
  padding: 16px 18px;
  animation: fadeUp 0.6s ease both;
}
.legend-item:nth-child(1) { animation-delay: 0.7s; }
.legend-item:nth-child(2) { animation-delay: 0.8s; }
.legend-item:nth-child(3) { animation-delay: 0.9s; }
.legend-num {
  font-family: var(--mono); font-size: 9px; font-weight: 700;
  color: rgba(255,255,255,0.2); letter-spacing: 0.1em;
  margin-bottom: 6px;
}
.legend-title {
  font-size: 13px; font-weight: 700; color: white;
  margin-bottom: 5px; letter-spacing: -0.01em;
}
.legend-desc {
  font-family: var(--mono); font-size: 10px;
  color: rgba(255,255,255,0.35); line-height: 1.6;
}

/* Dotted animated connection lines drawn with CSS */
.connections-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;
}

/* Pulse dots on lines */
@keyframes travel {
  0%   { offset-distance: 0%; opacity: 0; }
  10%  { opacity: 1; }
  90%  { opacity: 1; }
  100% { offset-distance: 100%; opacity: 0; }
}

.section-label {
  font-family: var(--mono);
  font-size: 9px; font-weight: 700;
  letter-spacing: 0.15em; text-transform: uppercase;
  color: rgba(255,255,255,0.2);
  margin-bottom: 12px;
  margin-top: 40px;
  display: flex; align-items: center; gap: 10px;
}
.section-label::after {
  content: ''; flex: 1; height: 1px;
  background: rgba(255,255,255,0.07);
}
</style>
</head>
<body>
<div class="page">

  <!-- Header -->
  <div class="header">
    <div class="header-eyebrow">System Architecture</div>
    <h1>PAWS <span>Alert</span> Infrastructure</h1>
    <div class="header-sub">Complete service map ¬∑ All connected systems ¬∑ Live deployment</div>
  </div>

  <!-- Main Diagram -->
  <div class="diagram" id="diagram">

    <!-- TOP ROW -->
    <div class="node node-pink pos-tl">
      <span class="node-icon">üåê</span>
      <div class="node-label">Domain Registrar</div>
      <div class="node-name">Namecheap</div>
      <div class="node-detail">paws-alert.com purchased here. Nameservers pointed to Netlify DNS for full DNS control.</div>
      <div class="node-badge">paws-alert.com</div>
    </div>

    <div class="node node-gold pos-tc">
      <span class="node-icon">üì±</span>
      <div class="node-label">SMS Carrier</div>
      <div class="node-name">Twilio</div>
      <div class="node-detail">Toll-free number +1 (866) 384-7549. Handles all inbound/outbound SMS. Webhook fires to backend on every text.</div>
      <div class="node-badge">‚è≥ Verification Pending</div>
      <div class="node-url">+18663847549</div>
    </div>

    <div class="node node-cyan pos-tr">
      <span class="node-icon">üóÑÔ∏è</span>
      <div class="node-label">Database</div>
      <div class="node-name">Neon PostgreSQL</div>
      <div class="node-detail">Serverless Postgres. Stores staff, sections, students, alert logs, delivery receipts, SMS sessions, join codes.</div>
      <div class="node-badge">neon.tech</div>
      <div class="node-url">ep-curly-cake-...neon.tech</div>
    </div>

    <!-- MIDDLE ROW -->
    <div class="node node-blue pos-ml">
      <span class="node-icon">üñ•Ô∏è</span>
      <div class="node-label">Frontend Hosting</div>
      <div class="node-name">Render</div>
      <div class="node-detail">Hosts the React staff dashboard. Static site deployment. Auto-deploys on GitHub push.</div>
      <div class="node-badge">Static Site</div>
      <div class="node-url">app.paws-alert.com</div>
    </div>

    <!-- CENTER NODE -->
    <div class="node node-center pos-mc">
      <span class="node-icon">üêæ</span>
      <div class="node-label">Core System</div>
      <div class="node-name">PAWS Alert</div>
      <div class="node-detail" style="color:rgba(255,255,255,0.5);font-size:11px;">Emergency Notification System<br>Pellissippi State Community College</div>
      <div class="node-center-pulse"></div>
    </div>

    <div class="node node-green pos-mr">
      <span class="node-icon">‚öôÔ∏è</span>
      <div class="node-label">Backend Hosting</div>
      <div class="node-name">Render</div>
      <div class="node-detail">Hosts the FastAPI Python backend. Web service with auto-deploy. Runs the SMS webhook, API, and alert scheduler.</div>
      <div class="node-badge">Web Service</div>
      <div class="node-url">staffalert.onrender.com</div>
    </div>

    <!-- BOTTOM ROW -->
    <div class="node node-purple pos-bl">
      <span class="node-icon">üìÑ</span>
      <div class="node-label">Landing Page</div>
      <div class="node-name">Netlify</div>
      <div class="node-detail">Hosts paws-alert.com consent/landing page. Also manages DNS for all subdomains including app.paws-alert.com CNAME.</div>
      <div class="node-badge">DNS + Hosting</div>
      <div class="node-url">paws-alert.com</div>
    </div>

    <div class="node node-blue pos-bc">
      <span class="node-icon">üíª</span>
      <div class="node-label">Version Control</div>
      <div class="node-name">GitHub</div>
      <div class="node-detail">Two repos ‚Äî frontend and backend. Push to main triggers auto-deploy on Render. Netlify also pulls from GitHub.</div>
      <div class="node-badge">2 Repositories</div>
    </div>

    <div class="node node-red pos-br">
      <span class="node-icon">ü§ñ</span>
      <div class="node-label">AI Engine</div>
      <div class="node-name">Claude API</div>
      <div class="node-detail">Powers the SMS staff conversation flow. Staff texts the number, Claude guides them through sending alerts, getting join codes, and checking stats.</div>
      <div class="node-badge">claude-sonnet</div>
      <div class="node-url">api.anthropic.com</div>
    </div>

  </div><!-- end diagram -->

  <!-- SVG Connection Lines -->
  <svg style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:visible;" id="svgLines">
    <defs>
      <marker id="arrow-blue" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
        <path d="M0,0 L6,3 L0,6 Z" fill="rgba(59,130,246,0.6)" />
      </marker>
      <marker id="arrow-gold" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
        <path d="M0,0 L6,3 L0,6 Z" fill="rgba(245,158,11,0.6)" />
      </marker>
      <marker id="arrow-green" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
        <path d="M0,0 L6,3 L0,6 Z" fill="rgba(16,185,129,0.6)" />
      </marker>
      <marker id="arrow-purple" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
        <path d="M0,0 L6,3 L0,6 Z" fill="rgba(139,92,246,0.6)" />
      </marker>
    </defs>
  </svg>

  <!-- Flow Legend -->
  <div class="section-label" style="margin-top:48px;">Data Flow Explained</div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-num">FLOW 01</div>
      <div class="legend-title">Student SMS Enrollment</div>
      <div class="legend-desc">Student texts JOIN CS101 XK9P2M ‚Üí Twilio receives it ‚Üí fires webhook to Render backend ‚Üí backend validates join code against Neon DB ‚Üí enrolls student ‚Üí Twilio sends confirmation back to student's phone</div>
    </div>
    <div class="legend-item">
      <div class="legend-num">FLOW 02</div>
      <div class="legend-title">Staff Dashboard Alert</div>
      <div class="legend-desc">Staff logs into app.paws-alert.com (Render frontend) ‚Üí selects section + message ‚Üí React calls Render backend API ‚Üí backend queries Neon for recipients ‚Üí loops through Twilio to send SMS to every enrolled student ‚Üí logs delivery receipts back to Neon</div>
    </div>
    <div class="legend-item">
      <div class="legend-num">FLOW 03</div>
      <div class="legend-title">Staff SMS Interaction</div>
      <div class="legend-desc">Staff texts any message ‚Üí Twilio webhook ‚Üí backend checks if number is registered staff in Neon ‚Üí if yes, Claude API guides conversation ‚Üí staff picks section + priority + message ‚Üí backend fires broadcast via Twilio ‚Üí result texted back to staff</div>
    </div>
    <div class="legend-item">
      <div class="legend-num">FLOW 04</div>
      <div class="legend-title">Deploy Pipeline</div>
      <div class="legend-desc">Code pushed to GitHub ‚Üí Render auto-detects push ‚Üí builds and deploys backend (FastAPI) and frontend (React/Vite) ‚Üí Netlify auto-deploys consent page from its own GitHub repo ‚Üí live within ~2 minutes</div>
    </div>
    <div class="legend-item">
      <div class="legend-num">FLOW 05</div>
      <div class="legend-title">DNS Resolution</div>
      <div class="legend-desc">paws-alert.com bought on Namecheap ‚Üí nameservers pointed to Netlify ‚Üí Netlify manages all DNS records ‚Üí paws-alert.com serves consent page ‚Üí app.paws-alert.com CNAME points to Render frontend ‚Üí api subdomain points to Render backend</div>
    </div>
    <div class="legend-item">
      <div class="legend-num">FLOW 06</div>
      <div class="legend-title">Scheduled Alerts</div>
      <div class="legend-desc">Staff schedules alert via dashboard ‚Üí stored in Neon with UTC timestamp ‚Üí APScheduler on Render backend checks every 60 seconds ‚Üí when time is due fires broadcast via Twilio ‚Üí updates status in Neon ‚Üí logs delivery receipts</div>
    </div>
  </div>

  <!-- Service count footer -->
  <div style="margin-top:48px;display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
    {[
      ["7", "External Services"],
      ["2", "Render Deployments"],
      ["2", "GitHub Repos"],
      ["1", "Database"],
      ["1", "SMS Provider"],
      ["1", "Domain + DNS"],
    ].map ? "" : ""}
  </div>

  <div style="margin-top:40px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 18px;">
      <span style="font-size:18px;">üî¢</span>
      <div>
        <div style="font-size:20px;font-weight:800;letter-spacing:-0.03em;">7</div>
        <div style="font-family:var(--mono);font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:0.1em;">SERVICES</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 18px;">
      <span style="font-size:18px;">üöÄ</span>
      <div>
        <div style="font-size:20px;font-weight:800;letter-spacing:-0.03em;">2</div>
        <div style="font-family:var(--mono);font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:0.1em;">DEPLOYMENTS</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 18px;">
      <span style="font-size:18px;">üì¶</span>
      <div>
        <div style="font-size:20px;font-weight:800;letter-spacing:-0.03em;">2</div>
        <div style="font-family:var(--mono);font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:0.1em;">GITHUB REPOS</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 18px;">
      <span style="font-size:18px;">üóÑÔ∏è</span>
      <div>
        <div style="font-size:20px;font-weight:800;letter-spacing:-0.03em;">1</div>
        <div style="font-family:var(--mono);font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:0.1em;">DATABASE</div>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:8px;padding:10px 18px;">
      <span style="font-size:18px;">üì±</span>
      <div>
        <div style="font-size:20px;font-weight:800;letter-spacing:-0.03em;">1</div>
        <div style="font-family:var(--mono);font-size:9px;color:rgba(255,255,255,0.35);letter-spacing:0.1em;">SMS PROVIDER</div>
      </div>
    </div>
  </div>

  <div style="text-align:center;margin-top:40px;font-family:var(--mono);font-size:10px;color:rgba(255,255,255,0.15);letter-spacing:0.1em;">
    PAWS ALERT ¬∑ PELLISSIPPI STATE COMMUNITY COLLEGE ¬∑ ENS v2.0
  </div>

</div><!-- end page -->

<script>
// Draw animated SVG connection lines between nodes
window.addEventListener('load', () => {
  const diagram = document.getElementById('diagram');
  const svg = document.getElementById('svgLines');
  const diagramRect = diagram.getBoundingClientRect();
  const pageRect = document.querySelector('.page').getBoundingClientRect();

  const nodes = diagram.querySelectorAll('.node');
  const nodeMap = {};
  nodes.forEach(n => {
    const classes = [...n.classList];
    const pos = classes.find(c => c.startsWith('pos-'));
    if (pos) {
      const rect = n.getBoundingClientRect();
      nodeMap[pos] = {
        cx: rect.left - pageRect.left + rect.width / 2,
        cy: rect.top - pageRect.top + rect.height / 2,
        top: rect.top - pageRect.top,
        bottom: rect.top - pageRect.top + rect.height,
        left: rect.left - pageRect.left,
        right: rect.left - pageRect.left + rect.width,
      };
    }
  });

  const connections = [
    // Center to all surrounding nodes
    { from: 'pos-mc', to: 'pos-tl', color: 'rgba(236,72,153,0.25)', dash: '4,6' },
    { from: 'pos-mc', to: 'pos-tc', color: 'rgba(245,158,11,0.35)', dash: '4,5' },
    { from: 'pos-mc', to: 'pos-tr', color: 'rgba(6,182,212,0.3)', dash: '4,6' },
    { from: 'pos-mc', to: 'pos-ml', color: 'rgba(59,130,246,0.35)', dash: '4,5' },
    { from: 'pos-mc', to: 'pos-mr', color: 'rgba(16,185,129,0.35)', dash: '4,5' },
    { from: 'pos-mc', to: 'pos-bl', color: 'rgba(139,92,246,0.3)', dash: '4,6' },
    { from: 'pos-mc', to: 'pos-bc', color: 'rgba(59,130,246,0.3)', dash: '4,5' },
    { from: 'pos-mc', to: 'pos-br', color: 'rgba(239,68,68,0.3)', dash: '4,6' },
    // Key cross connections
    { from: 'pos-tc', to: 'pos-mr', color: 'rgba(245,158,11,0.2)', dash: '2,8' },
    { from: 'pos-mr', to: 'pos-tr', color: 'rgba(6,182,212,0.2)', dash: '2,8' },
    { from: 'pos-ml', to: 'pos-bl', color: 'rgba(139,92,246,0.2)', dash: '2,8' },
    { from: 'pos-bc', to: 'pos-ml', color: 'rgba(59,130,246,0.2)', dash: '2,8' },
    { from: 'pos-bc', to: 'pos-mr', color: 'rgba(16,185,129,0.2)', dash: '2,8' },
    { from: 'pos-tl', to: 'pos-bl', color: 'rgba(236,72,153,0.15)', dash: '2,10' },
  ];

  svg.setAttribute('viewBox', `0 0 ${pageRect.width} ${pageRect.height + 200}`);

  connections.forEach(({ from, to, color, dash }) => {
    const a = nodeMap[from];
    const b = nodeMap[to];
    if (!a || !b) return;

    // Curved path
    const mx = (a.cx + b.cx) / 2;
    const my = (a.cy + b.cy) / 2 - 20;

    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', `M${a.cx},${a.cy} Q${mx},${my} ${b.cx},${b.cy}`);
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke', color);
    path.setAttribute('stroke-width', '1.5');
    path.setAttribute('stroke-dasharray', dash);
    svg.appendChild(path);

    // Animated traveling dot
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('r', '3');
    circle.setAttribute('fill', color.replace('0.', '0.9').replace(',0.', ',0.9'));

    const animMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
    animMotion.setAttribute('dur', `${2.5 + Math.random() * 2}s`);
    animMotion.setAttribute('repeatCount', 'indefinite');
    animMotion.setAttribute('begin', `${Math.random() * 3}s`);

    const mpath = document.createElementNS('http://www.w3.org/2000/svg', 'mpath');
    // Give path an id
    const pid = 'p' + Math.random().toString(36).slice(2);
    path.setAttribute('id', pid);
    mpath.setAttribute('href', '#' + pid);

    animMotion.appendChild(mpath);
    circle.appendChild(animMotion);
    svg.appendChild(circle);
  });
});
</script>
</body>
</html>
